<div class="flex h-screen overflow-hidden">
  <!-- Toast Notifications -->
  <div class="fixed right-4 top-4 z-50 space-y-2" aria-live="polite" aria-atomic="true">
    @for (toast of toast.toasts(); track toast.id) {
      <div
        [class]="
          'flex items-center gap-2 rounded-xl border px-4 py-2 text-sm shadow-lg backdrop-blur ' +
          (toast.variant === 'success'
            ? 'border-green-700/40 bg-green-900/60 text-green-200'
            : toast.variant === 'error'
              ? 'border-red-700/40 bg-red-900/60 text-red-200'
              : 'border-gray-700/40 bg-gray-900/60 text-gray-200')
        "
        role="status"
      >
        @if (toast.variant === 'success') {
          <svg
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
            />
          </svg>
        } @else if (toast.variant === 'error') {
          <svg
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"
            />
          </svg>
        } @else {
          <svg
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M11.25 11.25l.041-3.004a.75.75 0 0 1 1.5 0l.041 3.004m-1.582 2.878h.008v.008h-.008v-.008ZM21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
            />
          </svg>
        }
        <span>{{ toast.message }}</span>
      </div>
    }
  </div>

  <!-- Mobile overlay -->
  @if (sidebarOpen()) {
    <div
      class="fixed inset-0 z-20 bg-black/50 lg:hidden"
      (click)="sidebarOpen.set(false)"
      role="presentation"
    ></div>
  }

  <!-- Sidebar -->
  <aside
    [class]="
      'fixed inset-y-0 left-0 z-30 flex w-64 flex-col bg-gray-900 border-r border-gray-800 transition-transform duration-200 lg:static lg:translate-x-0 ' +
      (sidebarOpen() ? 'translate-x-0' : '-translate-x-full')
    "
  >
    <a
      routerLink="/dashboard"
      class="flex h-14 items-center gap-2 border-b border-gray-800 px-4 transition-opacity hover:opacity-80 cursor-pointer"
    >
      <span class="text-xl font-bold text-twitch">Twitch Miner</span>
    </a>

    <nav class="flex-1 space-y-1 p-3" aria-label="Main navigation">
      <!-- Dashboard Link -->
      <a
        routerLink="/dashboard"
        routerLinkActive="active-nav-link"
        #dashboardLink="routerLinkActive"
        class="group relative flex items-center gap-3 rounded-xl px-3 py-2.5 text-sm font-medium transition-all duration-200"
        [class]="
          dashboardLink.isActive
            ? 'bg-gradient-to-r from-twitch/20 to-twitch-dark/20 text-twitch-light border border-twitch/30'
            : 'text-gray-400 hover:bg-gray-800/70 hover:text-white border border-transparent'
        "
        (click)="sidebarOpen.set(false)"
      >
        @if (dashboardLink.isActive) {
          <span
            class="absolute left-0 h-8 w-1 rounded-r-full bg-gradient-to-b from-twitch to-twitch-light animate-slide-in"
          ></span>
        }
        <svg
          class="h-5 w-5 transition-transform group-hover:scale-110"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"
          />
        </svg>
        Dashboard
      </a>

      <!-- Admin Link -->
      @if (auth.isAdmin()) {
        <a
          routerLink="/admin"
          routerLinkActive="active-nav-link"
          #adminLink="routerLinkActive"
          class="group relative flex items-center gap-3 rounded-xl px-3 py-2.5 text-sm font-medium transition-all duration-200"
          [class]="
            adminLink.isActive
              ? 'bg-gradient-to-r from-twitch/20 to-twitch-dark/20 text-twitch-light border border-twitch/30'
              : 'text-gray-400 hover:bg-gray-800/70 hover:text-white border border-transparent'
          "
          (click)="sidebarOpen.set(false)"
        >
          @if (adminLink.isActive) {
            <span
              class="absolute left-0 h-8 w-1 rounded-r-full bg-gradient-to-b from-twitch to-twitch-light animate-slide-in"
            ></span>
          }
          <svg
            class="h-5 w-5 transition-transform group-hover:scale-110"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"
            />
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
            />
          </svg>
          Admin
        </a>
      }

      <!-- Settings Link -->
      <a
        routerLink="/settings"
        routerLinkActive="active-nav-link"
        #settingsLink="routerLinkActive"
        class="group relative flex items-center gap-3 rounded-xl px-3 py-2.5 text-sm font-medium transition-all duration-200"
        [class]="
          settingsLink.isActive
            ? 'bg-gradient-to-r from-twitch/20 to-twitch-dark/20 text-twitch-light border border-twitch/30'
            : 'text-gray-400 hover:bg-gray-800/70 hover:text-white border border-transparent'
        "
        (click)="sidebarOpen.set(false)"
      >
        @if (settingsLink.isActive) {
          <span
            class="absolute left-0 h-8 w-1 rounded-r-full bg-gradient-to-b from-twitch to-twitch-light animate-slide-in"
          ></span>
        }
        <svg
          class="h-5 w-5 transition-transform group-hover:scale-110"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
          />
        </svg>
        Settings
      </a>
    </nav>

    <!-- Sidebar Footer -->
    <div class="border-t border-gray-800 p-3 space-y-2">
      <!-- Invite Codes -->
      <app-sidebar-invite />

      <!-- Documentation Links -->
      <div class="space-y-1">
        <a
          href="https://miner.noxiousgaming.eu/api/docs"
          target="_blank"
          rel="noopener noreferrer"
          class="group flex items-center gap-3 rounded-xl border border-transparent px-3 py-2 text-sm font-medium text-gray-400 transition-all duration-200 hover:bg-gray-800/70 hover:text-white hover:border-gray-700/50"
        >
          <svg
            class="h-4 w-4 transition-transform group-hover:scale-110"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"
            />
          </svg>
          API Docs
        </a>
      </div>

      <!-- GitHub Link -->
      <div class="px-2 pt-1">
        <a
          href="https://github.com/CptObvs"
          target="_blank"
          rel="noopener noreferrer"
          class="group flex items-center justify-center gap-1.5 rounded-lg px-2 py-1 text-xs text-gray-500 transition-colors hover:text-gray-300 hover:bg-gray-800/50"
          title="GitHub"
        >
          <svg class="h-3.5 w-3.5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path
              fill-rule="evenodd"
              d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
              clip-rule="evenodd"
            />
          </svg>
          GitHub
        </a>
      </div>

      <!-- User Card -->
      <div class="rounded-xl border border-gray-800 bg-gray-800/30 p-3">
        <div class="flex items-center justify-between">
          <div class="min-w-0 flex-1">
            <p class="truncate text-sm font-semibold text-gray-200">
              {{ auth.currentUser()?.username }}
            </p>
            <p class="text-xs text-gray-500 capitalize">{{ auth.currentUser()?.role }}</p>
          </div>
          <button
            (click)="auth.logout()"
            class="group rounded-lg p-2 text-gray-400 transition-all duration-200 hover:bg-red-900/30 hover:text-red-400"
            aria-label="Logout"
            title="Logout"
          >
            <svg
              class="h-5 w-5 transition-transform group-hover:scale-110"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content Area -->
  <div class="flex flex-1 flex-col overflow-hidden">
    <!-- Mobile Header -->
    <header class="flex h-14 items-center border-b border-gray-800 px-4 lg:hidden">
      <button
        (click)="sidebarOpen.set(true)"
        class="rounded-lg p-2 text-gray-400 hover:bg-gray-800 hover:text-white"
        aria-label="Open sidebar"
      >
        <svg
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
          />
        </svg>
      </button>
      <span class="ml-3 text-lg font-bold text-twitch">Twitch Miner</span>
    </header>

    <!-- Routes Outlet -->
    <main class="flex-1 overflow-y-auto p-4 md:p-6">
      <router-outlet />
    </main>
  </div>
</div>
