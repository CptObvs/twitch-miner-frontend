<div class="mx-auto max-w-2xl">
  <div class="mb-6 flex flex-wrap items-center justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold gradient-text">Settings</h1>
      <p class="mt-1 text-sm text-gray-400">Manage your account settings</p>
    </div>
    <div
      class="flex items-center gap-2 rounded-2xl border border-gray-800 bg-gray-900/60 backdrop-blur-xl px-3 py-2 shadow-lg shadow-black/20"
    >
      <div
        class="flex items-center gap-2 rounded-xl bg-gray-800/70 border border-gray-700/50 px-2.5 py-1.5"
      >
        <svg
          class="h-4 w-4 text-twitch-light"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"
          />
        </svg>
        <span class="text-[11px] font-medium text-gray-400 uppercase tracking-wider">Username</span>
        <span class="text-sm font-semibold text-gray-100">{{ auth.currentUser()?.username }}</span>
      </div>
      <div
        class="flex items-center gap-2 rounded-xl bg-gray-800/70 border border-gray-700/50 px-2.5 py-1.5"
      >
        <svg
          class="h-4 w-4 text-gray-400"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"
          />
        </svg>
        <span class="text-[11px] font-medium text-gray-400 uppercase tracking-wider">Role</span>
        <span
          [class]="
            'rounded-full px-2 py-0.5 text-xs font-semibold ' +
            (auth.currentUser()?.role === 'admin'
              ? 'bg-twitch/20 text-twitch-light border border-twitch/30'
              : 'bg-gray-700 text-gray-300 border border-gray-600')
          "
        >
          {{ auth.currentUser()?.role }}
        </span>
      </div>
    </div>
  </div>

  <div
    class="rounded-2xl border border-gray-800 bg-gradient-to-br from-gray-900 via-gray-900 to-gray-800/50 backdrop-blur-xl p-5 shadow-xl shadow-black/20"
  >
    <div class="mb-4 flex items-center gap-2.5">
      <div class="rounded-lg bg-gray-800/50 p-2.5">
        <svg
          class="h-5 w-5 text-gray-400"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"
          />
        </svg>
      </div>
      <h2 class="text-base font-semibold text-gray-100">Change Password</h2>
    </div>

    <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
      <div class="space-y-3">
        <div>
          <label for="current-password" class="mb-1.5 block text-xs font-medium text-gray-300">
            Current Password
          </label>
          <input
            id="current-password"
            type="password"
            formControlName="currentPassword"
            class="w-full rounded-lg border bg-gray-800 px-3 py-2.5 text-sm text-gray-100 shadow-inner transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-twitch/50 focus:border-twitch"
            [class]="
              passwordForm.controls.currentPassword.invalid &&
              passwordForm.controls.currentPassword.touched
                ? 'border-red-500/50 focus:ring-red-500/50'
                : 'border-gray-700/50'
            "
          />
          @if (
            passwordForm.controls.currentPassword.invalid &&
            passwordForm.controls.currentPassword.touched
          ) {
            <p class="mt-1 text-sm text-red-400">Current password is required</p>
          }
        </div>

        <div>
          <label for="new-password" class="mb-1.5 block text-xs font-medium text-gray-300">
            New Password
          </label>
          <input
            id="new-password"
            type="password"
            formControlName="newPassword"
            class="w-full rounded-lg border bg-gray-800 px-3 py-2.5 text-sm text-gray-100 shadow-inner transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-twitch/50 focus:border-twitch"
            [class]="
              passwordForm.controls.newPassword.invalid && passwordForm.controls.newPassword.touched
                ? 'border-red-500/50 focus:ring-red-500/50'
                : 'border-gray-700/50'
            "
          />
          @if (
            passwordForm.controls.newPassword.invalid && passwordForm.controls.newPassword.touched
          ) {
            <p class="mt-1 text-sm text-red-400">Password must be at least 6 characters</p>
          }
        </div>

        <div>
          <label for="confirm-password" class="mb-1.5 block text-xs font-medium text-gray-300">
            Confirm New Password
          </label>
          <input
            id="confirm-password"
            type="password"
            formControlName="confirmPassword"
            class="w-full rounded-lg border bg-gray-800 px-3 py-2.5 text-sm text-gray-100 shadow-inner transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-twitch/50 focus:border-twitch"
            [class]="
              passwordForm.controls.confirmPassword.invalid &&
              passwordForm.controls.confirmPassword.touched
                ? 'border-red-500/50 focus:ring-red-500/50'
                : 'border-gray-700/50'
            "
          />
          @if (
            passwordForm.controls.confirmPassword.invalid &&
            passwordForm.controls.confirmPassword.touched
          ) {
            <p class="mt-1 text-sm text-red-400">Passwords do not match</p>
          }
        </div>

        @if (error()) {
          <div
            class="rounded-xl bg-red-900/50 border border-red-700/50 p-4 text-sm text-red-300 shadow-lg shadow-red-900/20"
            role="alert"
          >
            <div class="flex items-center gap-2">
              <svg
                class="h-5 w-5 shrink-0"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"
                />
              </svg>
              {{ error() }}
            </div>
          </div>
        }

        @if (success()) {
          <div
            class="rounded-xl bg-green-900/50 border border-green-700/50 p-4 text-sm text-green-300 shadow-lg shadow-green-900/20"
            role="alert"
          >
            <div class="flex items-center gap-2">
              <svg
                class="h-5 w-5 shrink-0"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
                />
              </svg>
              Password changed successfully
            </div>
          </div>
        }

        <button
          type="submit"
          [disabled]="passwordForm.invalid || loading()"
          class="group relative w-full overflow-hidden rounded-lg bg-gradient-to-r from-twitch to-twitch-dark border border-twitch-light/20 px-5 py-2.5 text-sm font-bold text-white shadow-lg shadow-twitch/20 transition-all duration-200 hover:scale-105 hover:shadow-xl hover:shadow-twitch/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 active:scale-95"
        >
          <span
            class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/10 to-white/0 translate-x-[-200%] group-hover:translate-x-[200%] transition-transform duration-700"
          ></span>
          @if (loading()) {
            <span class="flex items-center justify-center gap-2">
              <span
                class="h-4 w-4 animate-spin rounded-full border-2 border-white/30 border-t-white"
              ></span>
              Changing Password...
            </span>
          } @else {
            Change Password
          }
        </button>
      </div>
    </form>
  </div>
</div>
