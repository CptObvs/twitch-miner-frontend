<div class="mx-auto max-w-6xl">
  <div class="mb-8 flex flex-col gap-6">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold gradient-text">Instances</h1>
        <p class="mt-1 text-sm text-gray-400">Manage your Twitch miner instances</p>
      </div>
      <div class="flex gap-3">
        <button
          (click)="loadInstances()"
          class="group rounded-xl bg-gray-800/70 border border-gray-700/50 p-3 text-sm font-medium text-gray-300 transition-all duration-200 hover:bg-gray-700 hover:border-gray-600 hover:text-white active:scale-95"
          aria-label="Refresh instances"
          title="Refresh instances"
        >
          <svg
            class="h-5 w-5 transition-transform group-hover:rotate-180 duration-500"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182"
            />
          </svg>
        </button>
        <button
          (click)="showCreate.set(true)"
          class="rounded-xl bg-gradient-to-r from-twitch to-twitch-dark border border-twitch-light/20 px-6 py-3 text-sm font-bold text-white transition-all duration-200 hover:shadow-lg hover:shadow-twitch/40 hover:scale-105 active:scale-95"
        >
          <span class="flex items-center gap-2">
            <svg
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
            >
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            New Instance
          </span>
        </button>
      </div>
    </div>

    @if (useCompact() && instances().length > 0 && !loading()) {
      <div class="grid gap-4 sm:grid-cols-3">
        <div
          class="rounded-xl border border-gray-800 bg-gradient-to-br from-gray-900 to-gray-800/50 p-4"
        >
          <div class="flex items-center gap-3">
            <div class="rounded-lg bg-twitch/20 p-3">
              <svg
                class="h-6 w-6 text-twitch-light"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z"
                />
              </svg>
            </div>
            <div>
              <p class="text-xs font-medium text-gray-400">Total Instances</p>
              <p class="text-2xl font-bold text-gray-100">{{ instances().length }}</p>
            </div>
          </div>
        </div>
        <div
          class="rounded-xl border border-green-900/30 bg-gradient-to-br from-gray-900 to-green-900/10 p-4"
        >
          <div class="flex items-center gap-3">
            <div class="rounded-lg bg-green-500/20 p-3">
              <svg
                class="h-6 w-6 text-green-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"
                />
              </svg>
            </div>
            <div>
              <p class="text-xs font-medium text-gray-400">Running</p>
              <p class="text-2xl font-bold text-green-400">{{ runningCount() }}</p>
            </div>
          </div>
        </div>
        <div
          class="rounded-xl border border-gray-800 bg-gradient-to-br from-gray-900 to-gray-800/50 p-4"
        >
          <div class="flex items-center gap-3">
            <div class="rounded-lg bg-gray-700/50 p-3">
              <svg
                class="h-6 w-6 text-gray-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"
                />
              </svg>
            </div>
            <div>
              <p class="text-xs font-medium text-gray-400">Stopped</p>
              <p class="text-2xl font-bold text-gray-300">{{ stoppedCount() }}</p>
            </div>
          </div>
        </div>
      </div>
    }
  </div>

  @if (loading()) {
    <app-loading-view [large]="true" />
  } @else if (error()) {
    <app-error-view [message]="error()" />
  } @else if (instances().length === 0) {
    <div class="rounded-2xl border border-gray-800 bg-gray-900 p-12 text-center backdrop-blur-sm">
      <div class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gray-800">
        <svg
          class="h-8 w-8 text-gray-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z"
          />
        </svg>
      </div>
      <p class="text-lg font-semibold text-gray-300">No instances yet</p>
      <p class="mt-2 text-sm text-gray-500">Create your first miner instance to get started.</p>
      <button
        (click)="showCreate.set(true)"
        class="mt-6 rounded-xl bg-gradient-to-r from-twitch to-twitch-dark border border-twitch-light/20 px-6 py-3 text-sm font-bold text-white transition-all duration-200 hover:shadow-lg hover:shadow-twitch/40 hover:scale-105 active:scale-95"
      >
        Create Instance
      </button>
    </div>
  } @else {
    @if (useCompact()) {
      <div class="flex flex-col gap-3">
        @for (inst of instances(); track inst.id) {
          <app-instance-card
            [instance]="inst"
            [compact]="true"
            [actionLoading]="isActionLoading(inst.id)"
            [ownerName]="isAdmin() ? getUserName(inst.user_id) : null"
            (start)="startInstance(inst.id)"
            (stop)="stopInstance(inst.id)"
            (delete)="deleteInstance(inst.id)"
          />
        }
      </div>
    } @else {
      <div class="flex flex-col gap-10">
        @for (inst of instances(); track inst.id) {
          <app-instance-card
            [instance]="inst"
            [actionLoading]="isActionLoading(inst.id)"
            (start)="startInstance(inst.id)"
            (stop)="stopInstance(inst.id)"
            (delete)="deleteInstance(inst.id)"
          />
        }
      </div>
    }
  }

  @if (showCreate()) {
    <app-create-instance-dialog
      (close)="showCreate.set(false)"
      (created)="createInstance($event)"
    />
  }
</div>
