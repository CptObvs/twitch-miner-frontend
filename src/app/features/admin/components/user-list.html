<div class="overflow-x-auto">
  <table class="w-full text-left text-sm">
    <thead class="sticky top-0 bg-gray-900 backdrop-blur-sm z-10">
      <tr class="border-b border-gray-700/50 text-xs text-gray-400 uppercase tracking-wider">
        <th class="px-5 py-4 font-semibold">Username</th>
        <th class="px-5 py-4 font-semibold">Role</th>
        <th class="px-5 py-4 font-semibold">Invite Limit</th>
        <th class="px-5 py-4 font-semibold">Created</th>
        <th class="px-5 py-4 font-semibold">Actions</th>
      </tr>
    </thead>
    <tbody>
      @for (user of users(); track user.id) {
        <tr class="border-b border-gray-800/50 transition-colors duration-150 hover:bg-gray-800/30">
          <td class="px-5 py-4 text-gray-200 font-medium">{{ user.username }}</td>
          <td class="px-5 py-4">
            <span
              [class]="
                'rounded-full px-2 py-0.5 text-xs font-medium ' +
                (user.role === 'admin'
                  ? 'bg-twitch/20 text-twitch-light'
                  : 'bg-gray-800 text-gray-400')
              "
            >
              {{ user.role }}
            </span>
          </td>
          <td class="px-5 py-4">
            @if (editingUserId() === user.id) {
              <div class="flex items-center gap-2">
                <input
                  type="number"
                  min="0"
                  max="100"
                  [value]="editValue()"
                  (input)="editValue.set(+$any($event.target).value)"
                  class="w-16 rounded-lg border border-gray-700 bg-gray-800 px-2 py-1 text-xs text-gray-200 focus:border-twitch focus:outline-none"
                />
                <app-button variant="success" (click)="saveInviteLimit(user.id)">Save</app-button>
                <app-button variant="secondary" (click)="cancelEdit()">Cancel</app-button>
              </div>
            } @else {
              <button
                (click)="startEdit(user.id, user.max_invite_codes)"
                class="flex items-center gap-1 rounded-md px-2 py-0.5 text-xs text-gray-300 hover:bg-gray-800 transition-colors"
                title="Click to edit invite limit"
              >
                {{ user.max_invite_codes }}
                <svg
                  class="h-3 w-3 text-gray-500"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"
                  />
                </svg>
              </button>
            }
          </td>
          <td class="px-5 py-4 text-gray-400">{{ formatDate(user.created_at) }}</td>
          <td class="px-5 py-4">
            <app-button
              variant="secondary"
              (click)="
                toggleRole.emit({
                  userId: user.id,
                  newRole: user.role === 'admin' ? 'user' : 'admin',
                })
              "
            >
              Make {{ user.role === 'admin' ? 'User' : 'Admin' }}
            </app-button>
          </td>
        </tr>
      }
    </tbody>
  </table>
</div>
